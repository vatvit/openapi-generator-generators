<?php

declare(strict_types=1);

/**
 * GENERATED API ROUTES
 *
 * This file is generated from OpenAPI specification.
 * Include this file from your Laravel routes/api.php within a Route::group.
 *
 * Routes will use middleware groups with 'api.security.' prefix if they are defined.
 * Define these groups in bootstrap/app.php when you need security for an operation.
 *
 * Usage in routes/api.php:
 * ```php
 * Route::group(['prefix' => 'v1', 'middleware' => ['api']], function ($router) {
 *     require base_path('vendor/{{invokerPackagePath}}/routes/{{routesPattern}}');
 * });
 * ```
 *
 * MIDDLEWARE USAGE:
 *
 * Routes will automatically use middleware groups named 'api.security.{operationId}'
 * if they are defined in your application. Define middleware groups in bootstrap/app.php:
 *
 * ```php
 * ->withMiddleware(function (Middleware $middleware): void {
 *     $middleware->group('api.security.createGame', [
 *         \{{controllerNamespace}}\Middleware\AuthenticateBearerHttpAuthentication::class,
 *     ]);
 * })
 * ```
 *
 * Routes will only have middleware attached if their corresponding group is defined.
 * Operations without defined middleware groups will have no middleware applied.
 */

// Use $router variable passed from Route::group closure
// This file expects $router to be available from the including context

{{#operations}}
/**
 * {{httpMethod}} {{path}}
{{#summary}}
 * {{summary}}
{{/summary}}
{{#notes}}
 * {{notes}}
{{/notes}}
{{#hasAuthMethods}}
 *
 * Security Requirements:
{{#authMethods}}
 * - {{name}}{{#type}} ({{type}}){{/type}}
{{/authMethods}}
{{/hasAuthMethods}}
 */
$route = $router->{{httpMethod}}('{{path}}', \{{controllerNamespace}}\{{operationIdCamelCase}}Controller::class)
    ->name('api.{{operationId}}');

{{#hasAuthMethods}}
// Attach middleware group if defined (conditional security)
if ($router->hasMiddlewareGroup('api.security.{{operationId}}')) {
    $route->middleware('api.security.{{operationId}}');
}
{{/hasAuthMethods}}

{{/operations}}

// ============================================================================
// Security Middleware Validation (Auto-generated)
// ============================================================================
// Validates that all required security middleware is properly configured
// Only runs when APP_DEBUG=true (development mode)
// ============================================================================

if (config('app.debug', false)) {
    // Validate security middleware configuration
    try {
        \{{securityNamespace}}\SecurityValidator::validateMiddleware($router);
    } catch (\RuntimeException $e) {
        // Log validation errors but don't break the application
        error_log("Security middleware validation failed:");
        error_log($e->getMessage());
    }
}
